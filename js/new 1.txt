

//获取查老师源代码
var teacher;
var score;
var data;
var json;
var data2;
var cache;
var info;
function getAjaxReturn(success_function,teacher) 
{ 

$.ajax({ 
type:"POST", 
url: "http://chalaoshi.cn/search?q="+teacher,
success:function(msg){ 
info=success_function(msg); 
} 
}); 
alert(info); 
return info;
} 



function success_function(info) 
{ 
//do what you want do 
alert(info); 
return info;
} 



function getscore(teacher){
	//xmlhttp=new XMLHttpRequest();
	//data=xmlhttp.open("GET","http://chalaoshi.cn/search?q=李将云",true).responseText;
	
	//alert(data2)
	//xmlhttp.send();
	
	//$.getJSON("http://chalaoshi.cn/search?q=李将云",
    //function (data) {
    //    alert(data);
    //})

	
	//var datacache="http://chalaoshi.cn/search?q="+teacher
	
	//var data=$.ajax({type: "GET",url: "http://chalaoshi.cn/search?q=%E6%9D%8E%E5%B0%86%E4%BA%91",dataType: "jsonp",async: false,cache: false});
	//alert(data);
	
var msg;

try
{
$.ajax({
   type: "GET",
   url: "http://chalaoshi.cn/search?q="+teacher,
   async: false,
   cache: false,
    success: function(data){
			//alert (data);
			data=data.match(/<h2>.{3}<\/h2>/);
			//alert (data);
			data=data[0].substring(4,7);
			msg = data;

	//alert( "Data Saved: " + msg );
   }
});


return msg;
 
}
catch(err)
{
return "无";
}
}

	
//添加老师分数

var item=document.getElementById("jsgrid"); 
var tbody=item.getElementsByTagName("tbody")[0]; 
var trs=tbody.getElementsByTagName("tr"); 
var fnMethodName = function(cache){
	cache=cache.match(/<h2>.{3}<\/h2>/);
	cache=cache[0].substring(4,7);
	alert(cache);
	return cache;
};

alert("开始查询老师评分及课程余量，无余量的课程将不可用！加载时间可能较长，请稍候！");
	for(var i=1;i<trs.length;i++){ 
		var teacher=trs[i].innerHTML;
		teacher=teacher.match(/target="_blank">.{1,}<\/a>/);
		teacher=teacher[0].match(/>.{1,}</);
		teacher=teacher[0].match(/[\u4e00-\u9fa5a-zA-Z\s]{1,}/);
		teacher=teacher[0].substring(0,3);
		teacher=encodeURIComponent(teacher);
		data2=getAjaxReturn(success_function,teacher);
		alert (data2);
		data2=data2.match(/<h2>.{3}<\/h2>/);
		
		data2=data2[0].substring(4,7);
		
		
		
		var tds=trs[i].getElementsByTagName("td"); 
		var span=document.createElement("td");  
		if (data2>8.0){
		span.innerHTML='<font color="red">评分：' +data2;
		tds[0].appendChild(span);  
		}
		else{
		span.innerHTML='<font color="">评分：' +data2;
		tds[0].appendChild(span);  
		}

		var space=tds[7].innerHTML; 
		space=space.match(/[-\d{1,}\/]/);
		space=space[0].match(/\d{1,}/);
		if (space<=0){
		var input=tds[12].getElementsByTagName("input"); 
		input[0].setAttribute("disabled","disabled"); 
		}
	}
