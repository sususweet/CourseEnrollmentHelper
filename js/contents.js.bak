
var item=document.getElementById("jsgrid"); 
var tbody=item.getElementsByTagName("tbody")[0]; 
var trs=tbody.getElementsByTagName("tr"); 
var xmlhttp;
var courseinfo=new Array();
var busytime="";
var progress=0;
var id;
var Showscore;
var ShowGPA;
var Timecheck;
var Sparecheck;
var student;
var permit=0;
var subject;
var Debugmode=1;
var sort=0;
var tdstitle;
var adjustinner;

function trimStr(str){return str.replace(/(^\s*)|(\s*$)/g,"");}

function trychoose(){

	xmlhttp=new XMLHttpRequest();     
	xmlhttp.onreadystatechange = zswFun;
    xmlhttp.open('POST', 'http://jwbinfosys.zju.edu.cn/ajax/zjdx.AjaxForm,zjdx.ashx?_method=xsxk_xk&_session=no', true);
	xmlhttp.send("xh_str=3150103802\r\nxkkh_str=(2015-2016-2)-081C0251-0089098-1\r\ncxtab_str=xkrw2006view\r\ncrud=1");
	//data=xmlhttp.responseText;   
	//data=$.ajax({ 
	//type:"POST", 
	//async: false,
	//url: " http://jwbinfosys.zju.edu.cn/ajax/zjdx.AjaxForm,zjdx.ashx?_method=xsxk_xk&_session=no",
	//data: "xh_str=3150103802xkkh_str=(2015-2016-2)-081C0251-0089098-1cxtab_str=xkrw2006viewcrud=1",
	 
	//}); 

}

function zswFun(){    
if(xmlhttp.readyState == 4 && xmlhttp.status == 200){    
        var data = xmlhttp.responseText;    
		console.log(data);
	   
        }                 
    }    

function Converttime(time){
	var res="";
	if (time.indexOf("1")>=0&&time.indexOf("10")<0&&time.indexOf("11")<0&&time.indexOf("12")<0&&time.indexOf("13")<0) {res=res+",01";}
	if (time.indexOf("2")>=0&&time.indexOf("12")<0) {res=res+",02";}
	if (time.indexOf("3")>=0&&time.indexOf("13")<0) {res=res+",03";}
	if (time.indexOf("4")>=0) {res=res+",04";}
	if (time.indexOf("5")>=0) {res=res+",05";}
	if (time.indexOf("6")>=0) {res=res+",06";}
	if (time.indexOf("7")>=0) {res=res+",07";}
	if (time.indexOf("8")>=0) {res=res+",08";}
	if (time.indexOf("9")>=0) {res=res+",09";}
	if (time.indexOf("10")>=0) {res=res+",10";}
	if (time.indexOf("11")>=0) {res=res+",11";}
	if (time.indexOf("12")>=0) {res=res+",12";}
	if (time.indexOf("13")>=0) {res=res+",13";}
	return res;
}
	
function Convertterm(term){
	//获取课程所在学期
	var termcache="";
	if (term.indexOf("秋")>=0){termcache=termcache+",01";}
	if (term.indexOf("冬")>=0){termcache=termcache+",02";}
	if (term.indexOf("春")>=0){termcache=termcache+",03";}
	if (term.indexOf("夏")>=0){termcache=termcache+",04";}
	return termcache;
}

function Convertweekly(week){
	//获取课程所在学期
	var weekcache="";
	if (week.indexOf("双周")>=0){weekcache = weekcache+",d";}
	else if (week.indexOf("单周")>=0){weekcache = weekcache+",s";}
	else {weekcache = weekcache+",d,s";}
	return weekcache;
}

function GetSubject(){
	//获取课程名
	subject = document.getElementById("Label_jbxx").innerText;
	subject = subject.match(/课程名称：.*学分/);
	subject = subject[0].substr(5);
	subject=trimStr(subject.substr(0,subject.length-2));
}


	
function Convertday(coursetime,courseterm){
	
	coursetime=coursetime.split("<br>");
	var convert="";
	var res="";
	termcache=Convertterm(courseterm).split(",");

for (var h=1;h<termcache.length;h++){ 
	
	for(var i=0;i<coursetime.length;i++){ 
	//console.log(coursetime[i]);
		weekcache=Convertweekly(coursetime[i]).split(",");

		if (coursetime[i].indexOf("周一")>=0) {
		var cache = Converttime(coursetime[i]).split(",");
			for(var j=1;j<cache.length;j++){
				for (var w=1;w<weekcache.length;w++){
				convert=convert+"1x"+cache[j]+termcache[h]+weekcache[w]+",";
				}
			}
		}
		
		if (coursetime[i].indexOf("周二")>=0) {
		var cache = Converttime(coursetime[i]).split(",");
			for(var j=1;j<cache.length;j++){
				for (var w=1;w<weekcache.length;w++){
				convert=convert+"2x"+cache[j]+termcache[h]+weekcache[w]+",";
				}
			}
		}
		if (coursetime[i].indexOf("周三")>=0) {
		var cache = Converttime(coursetime[i]).split(",");
			for(var j=1;j<cache.length;j++){
				for (var w=1;w<weekcache.length;w++){
				convert=convert+"3x"+cache[j]+termcache[h]+weekcache[w]+",";
				}
			}
		}
		if (coursetime[i].indexOf("周四")>=0) {
		var cache = Converttime(coursetime[i]).split(",");
			for(var j=1;j<cache.length;j++){
				for (var w=1;w<weekcache.length;w++){
				convert=convert+"4x"+cache[j]+termcache[h]+weekcache[w]+",";
				}
			}
		}
		
		if (coursetime[i].indexOf("周五")>=0) {
		var cache = Converttime(coursetime[i]).split(",");
			for(var j=1;j<cache.length;j++){
				for (var w=1;w<weekcache.length;w++){
				convert=convert+"5x"+cache[j]+termcache[h]+weekcache[w]+",";
				}
			}
		}
		
		if (coursetime[i].indexOf("周六")>=0) {
		var cache = Converttime(coursetime[i]).split(",");
			for(var j=1;j<cache.length;j++){
				for (var w=1;w<weekcache.length;w++){
				convert=convert+"6x"+cache[j]+termcache[h]+weekcache[w]+",";
				}
			}
		}
		
		if (coursetime[i].indexOf("周日")>=0) {
		var cache = Converttime(coursetime[i]).split(",");
			for(var j=1;j<cache.length;j++){
				for (var w=1;w<weekcache.length;w++){
				convert=convert+"7x"+cache[j]+termcache[h]+weekcache[w]+",";
				}
			}
		}
		
	
	}
}
	return convert;
}


function Checktime(){
try{
	//获取学号信息
	NProgress.inc();
	student=document.getElementById("Label_jbxx").innerText; 
	student=student.match(/学号：\d{1,}/);
	student=student[0].match(/\d{1,}/);
	student=student[0];
	data=$.ajax({ 
	type:"GET", 
	async: false,
	timeout : 5000,
	url: adjustinner+"/xskbcx.aspx?xh="+student,
	error:function (XMLHttpRequest,status,e){
		swal("获取课表错误！", "呜呜……选课小精灵发现教务网好像出了什么问题~主人快检查下能否正常进入教务网哦~", "error");
	}
	}).responseText; 
	NProgress.done();
		data=data.match(/<A href='#' onclick="window.open\('.{1,}','kcb','toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=1,resizable=1'\)">(<i><font color=red>){0,1}.{1,}(<\/font><\/i>){0,1}<\/a><\/td><td>.{1,}<\/td><td>.{1,}<\/td><td>.{1,}<\/td><td>.{1,}<\/td><td>.{1,}<\/td>/ig);
	//console.log (data);
	//console.log (data.length-1);


	for(var i=0;i<data.length;i++){ 
	
	var course=data[i].match(/<A href='#' onclick="window.open\('.{1,}','kcb','toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=1,resizable=1'\)">(<i><font color=red>){0,1}[0-9A-Z]{8}(<\/font><\/i>){0,1}<\/A>/g);
	
	course=course[0].match(/[0-9A-Z]{8}/);
	course=course[0];
	//console.log (course);
	
	
	//var coursesite=data[i].match(/<\/a><\/td>.{1,}<\/td>/g);
	//coursesite=coursesite[0].match(/<td>.{1,}<\/td><td>.{1,}<\/td><td>.{1,}<\/td>/g);
	//console.log (coursesite);
	
	try{
	var courseterm=data[i].match(/<td>[\u4e00-\u9fa5]{1,2}<\/td>/);
	courseterm=courseterm[0].match(/[\u4e00-\u9fa5]{1,2}/);
	courseterm=courseterm[0];
	//console.log (courseterm);
	}
	catch (err){
	courseterm="0";
	}
	
	try{
	var coursetime=data[i].match(/周[\u4e00-\u9fa5]{1}第.{1,}节.{0,4}<\/td>/g);
	//console.log (coursetime);
	coursetime=coursetime[0];
	//console.log (coursetime);
	coursetime=coursetime.replace("</td>","");
	//上课时间调试入口：console.log (coursetime);
	}
	catch (err){
	coursetime="0";
	}
	courseinfo[i]={course: course,courseterm: courseterm,coursetime: coursetime};

	console.log(courseinfo[i]);
	
	
	//res=Convertday(coursetime);
	//console.log(res);
	if (coursetime!="0"&&courseterm!="0"){
	busytime=busytime+Convertday(coursetime,courseterm);
	}
	
	}	

//console.log (busytime);
}
catch (err){
	swal("上课时间获取模块错误！", "呜呜……/(ㄒoㄒ)/~选课小精灵无法工作啦，主人检查下浏览器版本是否最新哦，或者联系作者详细描述错误情形以帮助改进插件吧~", "error");
}
			
}

function Sort(item,type){
	sortTable('jsgrid',item,type);
	sort++;
	console.log(sort);
	var temp=tdstitle[item].innerHTML;
	temp=temp.replace("▼","");
	temp=temp.replace("▲","");
	if (sort%2==0){
		tdstitle[item].innerHTML=temp+"▲";
	}else {
		tdstitle[item].innerHTML=temp+"▼";
	}
}

function AddSort(type){
	
	chrome.extension.sendRequest({key: "Showinfo"},function(Showinfo) {
	if (Showinfo==1){
		swal("教师排序模块已激活", "现在你可以点击表头的相应文字对所有教师进行排序，同时点击教师评分和均绩可进入学习帝查看评论详情~", "info");
		}
	});
	if (type==1){
		tdstitle[1].onmouseover=Changecursor; 
		tdstitle[1].onclick=function(){Sort(1,'float');}
	}
	tdstitle[3+type].onmouseover=Changecursor; 
	tdstitle[3+type].onclick=function(){Sort(3+type,'string');}
	tdstitle[4+type].onmouseover=Changecursor; 
	tdstitle[4+type].onclick=function(){Sort(4+type,'string');}
	tdstitle[6+type].onmouseover=Changecursor; 
	tdstitle[6+type].onclick=function(){Sort(6+type,'int');}

}

function Showprogress(progress){
	//修改浏览器标题栏
	tdstitle=trs[0].getElementsByTagName("td");
if (Showscore=="enabled"){
	//chrome.extension.sendMessage({cmd: "update",progress:progress},function(response) {});
		NProgress.set(progress/100); 
		var title = document.getElementsByTagName('title')[0];
		if (!title) {    
			var title = document.createElement('title');
			title.innerHTML = "萌萌哒选课精灵正在为你努力地工作哦……o(〃'▽'〃)o已完成："+Math.round(progress)+"%";
			document.getElementsByTagName('head')[0].appendChild(title);
		}
		else {title.innerHTML = "萌萌哒选课精灵正在为你努力地工作哦……o(〃'▽'〃)o已完成："+Math.round(progress)+"%";}
	
	if (progress==100){
		title.innerHTML = "选课精灵已经完成主人交给的任务了呢~\(^o^)/！现在主人可以很方便地选课啦~";
		chrome.extension.sendMessage({cmd: "finish"},function(response) {});
		NProgress.done(); 
		window.clearInterval(id);
		AddSort(1);

	}
	
}
else if(Timecheck=="enabled"||Sparecheck=="enabled"){
	chrome.extension.sendMessage({cmd: "finish"},function(response) {});
		AddSort(0);
		var title = document.getElementsByTagName('title')[0];
		if (!title) {    
			var title = document.createElement('title');
			title.innerHTML = "选课精灵已经完成主人交给的任务了呢~\(^o^)/！现在主人可以很方便地选课啦~";
			document.getElementsByTagName('head')[0].appendChild(title);
		}
		else {title.innerHTML = "选课精灵已经完成主人交给的任务了呢~\(^o^)/！现在主人可以很方便地选课啦~";}
}
	
	//chrome.extension.sendMessage({cmd: "update",progress:progress},function(response) {});
	//console.log(progress);
}

function Shownotice(Timecheck,Sparecheck,Showscore){
    //每隔3秒执行一次
	if (Showscore=="enabled"){
		//NProgress.start(); 
		//chrome.extension.sendMessage({cmd: "create2",progress:progress},function(response) {});
		chrome.extension.sendMessage({cmd: "create1"},function(response) {});
		id = window.setInterval("Showprogress(progress)",1000);
	}
	else if(Timecheck=="enabled"||Sparecheck=="enabled"){
		chrome.extension.sendMessage({cmd: "create1"},function(response) {});
		Showprogress(progress);
	}
}

function Time(){
try{
	for(var i=1;i<trs.length;i++){ 
		var tds=trs[i].getElementsByTagName("td"); 
		var term=tds[2].innerHTML; 
		var time=tds[3].innerHTML; 

		var targettime = Convertday(time,term);
		targettime=targettime.split(",");
		
		for (j=0;j<targettime.length-1;j++){
				if (busytime.indexOf(targettime[j])>=0) {
					//alert("1");
				//console.log(targettime[j]);
				//input[0].setAttribute("disabled","disabled"); 
				trs[i].style.color="#C2C2C2";
				break; 
				}
				else{
				trs[i].style.color="black";
				}
		}

				
		var course=document.getElementById("Label_jbxx").innerText; 
		course=course.match(/课程代码：.{8}/); 
		course=course[0].match(/[0-9A-Z]{8}/); 
		course=course[0];
		for (j=0;j<courseinfo.length;j++){
			if (course==courseinfo[j].course){
				if (time==courseinfo[j].coursetime && term==courseinfo[j].courseterm){trs[i].style.color="black";}
			}
		}
		
		if(trs[i].style.color=="rgb(194, 194, 194)"){
			trs[i].onmouseout=function(){ this.style.color="#C2C2C2";}
			trs[i].onmouseover=function(){ this.style.color="#8B8B8B";}	
		}
	}
}
catch(err)
{
	swal("时间冲突判断模块错误！", "呜呜……/(ㄒoㄒ)/~选课小精灵无法工作啦，主人检查下浏览器版本是否最新哦，或者联系作者详细描述错误情形以帮助改进插件吧~", "error");
}
}

function Spare(){
try{
	for(var i=1;i<trs.length;i++){ 
		var tds=trs[i].getElementsByTagName("td"); 
		var space=tds[6].innerHTML; 
		space=space.match(/[-\d{1,}\/]/);
		space=space[0].match(/\d{1,}/);
		var input=tds[11].getElementsByTagName("input"); 
		if (space<=0){
			if (input[0].checked==false){
			input[0].setAttribute("disabled","disabled"); 
			input[0].style.display="none";
			}
		}	
	}
}
catch(err)
{
	swal("课程余量判断模块错误！", "呜呜……/(ㄒoㄒ)/~选课小精灵无法工作啦，主人检查下浏览器版本是否最新哦，或者联系作者详细描述错误情形以帮助改进插件吧~", "error");
}
}

function Adjustlineheight(){
	for(var i=1;i<trs.length;i++){ 
		var tds=trs[i].getElementsByTagName("td"); 
		var span=document.createElement("td");  
		span.innerHTML='<div style="height:8px"></div>';
		tds[0].appendChild(span); 
	}		
}

function Highlight(){
	for(var i=1;i<trs.length;i++){ 
		var tds=trs[i].getElementsByTagName("td"); 
		var input=tds[11].getElementsByTagName("input"); 
		if (input[0].style.display!="none"&&trs[i].style.color=="black"){
			trs[i].style.backgroundColor="#D8FFD0";
			trs[i].onmouseout=function(){ this.style.backgroundColor="#D8FFD0";}
			trs[i].onmouseover=function(){ this.style.backgroundColor="#ACFF9B";}	
		}	
	}
}


function Changecursor(){this.style.cursor="pointer";}

function ChangeTitle(){
 var x=trs[0].insertCell(1);
  x.style.width="4%";
  x.innerHTML="评分";
  for (var t=1;t<=trs.length-1;t++){
		x=trs[t].insertCell(1);
		x.innerHTML="";
  }
}

function getAjaxReturn(times){
var mark;
var gpa;
var tid;

try{
if(times > trs.length-1){
return; 
}
progress=times/(trs.length-1)*100;

//获取教师分数
var teacher=trs[times].innerHTML;
teacher=teacher.match(/target="_blank">.{1,}<\/a>/);
teacher=teacher[0].match(/>.{1,}</);
teacher=teacher[0].match(/[\u4e00-\u9fa5a-zA-Z\s]{1,}/);
teacher=teacher[0].substring(0,3);
teacher=encodeURIComponent(teacher);
$.ajax({ 
	type:"GET", 
	//async: false,
	url: "http://chalaoshi.cn/search?q="+teacher,
		success:function(msg){ 
		//function(msg,i){
			//alert(times);
			var tds=trs[times].getElementsByTagName("td"); 
			var span=document.createElement("td");  
			var span2=document.createElement("td");  
			
try
{
		mark=msg.match(/<h2>.{3,4}<\/h2>/);
		mark=mark[0].match(/\d{1,2}\.\d{1}/);
		mark=mark[0];
		tid=msg.match(/teacher\/\d{1,4}/);
        tid=tid[0].match(/\d{1,4}/);
		tid=tid[0];
		//alert(span);
}
catch(err)
{
mark="无";
tid=0;
}
		if (mark>8.0){

		//span.innerHTML='<div style="width:60px"><font color="red">评分：' +mark+'</div>';
		span.innerHTML='<div style="height:8px"></div>';
		tds[1].innerHTML=mark;
		tds[1].style.color="red";
		tds[1].onclick=function (){window.open("http://chalaoshi.cn/teacher/" + tid+"/");}
		tds[1].onmouseover=Changecursor; 	
		tds[0].appendChild(span); 
		}
		else{
		span.innerHTML='<div style="height:8px"></div>';
		tds[1].innerHTML=mark;
		tds[1].style.color="";
		tds[1].onclick=function (){window.open("http://chalaoshi.cn/teacher/" + tid+"/");}
		tds[1].onmouseover=Changecursor; 
		tds[0].appendChild(span);  
		//span.innerHTML='<div style="width:60px"><font color="">评分：' +mark+'</div>';
		}
if (ShowGPA=="enabled"){
				$.ajax({
                    type: "GET",
                    url: "http://chalaoshi.cn/teacher/" + tid+"/",
					cache:false,
                    success: function (t) {
                        try {
                            var re =new RegExp("<p>"+subject+'<\/p><\/div><divclass="right"><p>[0-9]{0,3}\.[0-9]{0,3}\/[0-9]{0,1}');
							gpa= t.replace(/\s/g, "").match(re);
							gpa=gpa[0].match(/\d{1,3}\.\d{1,3}/);
							gpa=gpa[0];
                        } catch (err) {
                            gpa = "无";
                        }
                        span2.innerHTML ='<div style="width:70px">均绩：'+gpa+'</div>';
						tds[0].appendChild(span2);
						try{
						div=tds[0].getElementsByTagName("div");
						div[1].onclick=function (){window.open("http://chalaoshi.cn/teacher/" + tid+"/");}
						div[1].onmouseover=Changecursor;
						}
						catch (err){}
                    }
                });
}	
		//div=tds[0].getElementsByTagName("div");
		//console.log(tid);
		//tds[1].onclick=function (){window.open("http://chalaoshi.cn/teacher/" + tid+"/");}
		//div[0].onmouseover=Changecursor; 
	
		times ++;
		getAjaxReturn(times); 
		
		} 
	}); 
}
catch(err)
{
	swal("教师评分及均绩查询模块错误！", "呜呜……/(ㄒoㄒ)/~选课小精灵无法工作啦，主人检查下浏览器版本是否最新哦，或者联系作者详细描述错误情形以帮助改进插件吧~", "error");
}
}

function getSettings(){
	chrome.extension.sendRequest({key: "Showscore"},function(response) {
	Showscore=response;
	});
	chrome.extension.sendRequest({key: "ShowGPA"},function(response) {
	ShowGPA=response;
	});
	chrome.extension.sendRequest({key: "Timecheck"},function(response) {
	Timecheck=response;
	});
	chrome.extension.sendRequest({key: "Sparecheck"},function(response) {
	Sparecheck=response;
	});
}

function GetPermit(targetdata,student){
try{
	targetdata=targetdata.match(/richContent3'>\n.{0,}\n<\/div>/);
	targetdata=targetdata[0].match(/<p>\d{1,}<\/p>/g);
	for(var i=0;i<targetdata.length;i++){ 
		target=targetdata[i].match(/\d{1,}/);
		target=target[0];
		if (student==target){
			return 1;
		}
	}
	return 0;
}
catch(err)
{
	swal("身份验证模块错误！", "呜呜……/(ㄒoㄒ)/~选课小精灵无法工作啦，主人检查下浏览器版本是否最新哦，或者联系作者详细描述错误情形以帮助改进插件吧~", "error");
}
}


function Main(){
//try{
	if (Timecheck=="disabled"&&Sparecheck=="disabled"&&Showscore=="disabled"){
	swal("插件功能受限！", "主人貌似啥功能都没有开启哦~伐开心 TAT！快去浏览器右上角点击设置开启吧~", "warning");
	}
	else if (permit==0&&Showscore=="enabled"){
	Showscore="disabled";
	chrome.extension.sendMessage({cmd: "scoredisabled"},function(response) {});
	chrome.extension.sendMessage({cmd: "GPAdisabled"},function(response) {});
	swal("插件功能受限！", "由于插件中的教师查询模块涉及@ZJU学习帝的版权问题，只面向小范围开放测试\n插件此项功能即将自动关闭！！可点击右上角图标重新启用\n联系作者：1017417552@qq.com", "warning");
	}
	else {
		//swal({
		//title: "努力工作ing……",
        //text: "(＾－＾)V选课精灵正在查询主人所选内容哦~无余量的课程复选框将不可用，时间冲突的课程将变灰，可选课程将以绿色标注~还请主人稍等哦~O(∩_∩)O~~",
		//type: "success",
		//timer: 1200
		//});
	Shownotice(Timecheck,Sparecheck,Showscore);
	}
	
	if (Timecheck=="enabled"){Time();}
	if (Sparecheck=="enabled"){Spare();}
	Highlight();
	if (Showscore=="enabled"){ChangeTitle();getAjaxReturn(1);}
	else{Adjustlineheight();}
//}
///catch(err)
///{
///	swal("Main函数错误！", "呜呜……/(ㄒoㄒ)/~选课小精灵无法工作啦，主人检查下浏览器版本是否最新哦，或者联系作者详细描述错误情形以帮助改进插件吧~", "error");
//}
	
}


/*-------------------------------------核心函数结束-------------------------------*/
/*-------------------------------------主程序开始-------------------------------*/
adjustinner=window.document.location.origin;
chrome.extension.sendRequest({key: "update"},function(updateurl) {
chrome.extension.sendRequest({key: "Genuine"},function(isgenuine) {
	if (isgenuine==0){
		swal("主程序错误！", "检测到插件被二次打包！\n为保护作者版权，请重新下载官方版本！\n下载地址："+updateurl, "error");
	}
else{
Checktime();
try{
GetSubject();
NProgress.inc();
chrome.extension.sendRequest({key: "Getsettings"},function(response) {
	response=response.split(",");
	Showscore=response[0];
	ShowGPA=response[1];
	Timecheck=response[2];
	Sparecheck=response[3];
if (Showscore=="enabled"||ShowGPA=="enabled"){
var ajaxTimeoutTest=$.ajax({
　　url: "http://www.zjuchoosehelper.icoc.cc/nd.jsp?id=7",
　　timeout : 5000,
　　type : 'GET',
　　success:function(targetdata){	//请求成功的回调函数
		NProgress.done();
		chrome.extension.sendMessage({cmd: "clear"},function(response) {});
		permit=GetPermit(targetdata,student);
		Main();
　　},
　　complete:function(XMLHttpRequest,status){
　　　　if(status=='timeout'){
 　　　　　 ajaxTimeoutTest.abort();
			Showscore="disabled";
			ShowGPA="disabled";
			chrome.extension.sendMessage({cmd: "clear"},function(response) {});
			Main();
			swal("身份验证超时！", "呜呜呜呜……小精灵的身份验证超时啦…………刷新一下再试试吧！╮(╯▽╰)╭", "error");
　　　　}
		if(status=='error'){//超时,status还有success,error等值的情况
 　　　　　 ajaxTimeoutTest.abort();
 			Showscore="disabled";
			ShowGPA="disabled";
			chrome.extension.sendMessage({cmd: "clear"},function(response) {});
			Main();
			swal("身份验证超时！", "呜呜呜呜……小精灵的身份验证超时啦…………刷新一下再试试吧！╮(╯▽╰)╭", "error");
　　　　}
　　}
});
}
else {
	NProgress.done();
	chrome.extension.sendMessage({cmd: "clear"},function(response) {});
	Main();
}
});
}
catch(err)
{
	swal("主程序错误！", "呜呜……/(ㄒoㄒ)/~选课小精灵无法工作啦，主人检查下浏览器版本是否最新哦，或者联系作者详细描述错误情形以帮助改进插件吧~", "error");
}
}
});
});
//trychoose();
//Convertday();
//res=Convertday("周二第9节");
//console.log(res);